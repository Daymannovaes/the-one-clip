#!/usr/bin/env node

import { program } from 'commander';

// Import the subcommand functions from their files
import { analyzeCommand } from '../commands/analyze.js';
import { compressBatchCommand } from '../commands/compress-batch.js';

// ---------------------
// Analyze
// ---------------------
program
  .command('analyze <folder>')
  .description('Analyze videos in a folder for compression status')
  .action((folder) => {
    analyzeCommand(folder).then(results => {
      // console.table(results);
      console.log(results.map(result => result.file).join(' '));
    });
  });

// ---------------------
// analyze and compress
// ---------------------
program
  .command('analyze-and-compress <folder>')
  .description('Analyze videos in a folder for compression status and compress them')
  .action((folder) => {
    analyzeCommand(folder).then(results => {
      const files = results.map(result => `${folder}/${result.file}`);

      compressBatchCommand(files);
    });
  });

// Parse arguments
program.parse(process.argv);
